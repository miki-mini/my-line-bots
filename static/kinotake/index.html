<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>きのたけ聖戦 - 改行バトルの審判</title>
    <!-- Renamed CSS to force cache clear -->
    <link rel="stylesheet" href="/static/kinotake/kinotake.css?v=24">
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Zen+Maru+Gothic:wght@700&display=swap"
        rel="stylesheet">
    <link rel="icon" href="/static/kinotake/kinokotakenoko.png">
</head>

<body>
    <div id="bg-layer"></div>
    <div class="background-effects">
        <div id="sparkles"></div>
    </div>

    <div class="container">
        <header>
            <h1>きのたけ聖戦<span class="subtitle">〜改行バトルの審判〜</span></h1>
            <div class="referee-area">
                <!-- If image exists it will show, otherwise alt text/placeholder -->
                <img src="/static/kinotake/kinokotakenoko.png" id="referee-img" alt="Lesser Panda Referee"
                    class="referee"
                    onerror="this.style.display='none'; document.getElementById('referee-placeholder').style.display='block';">
                <div id="referee-placeholder" style="font-size: 100px; display:none;">🐼</div>
                <div class="speech-bubble" id="referee-speech">やんのかコラ！<br>(可愛い威嚇)</div>
            </div>
            <!-- BGM Controls -->
            <div class="audio-controls" style="position: absolute; top: 10px; right: 10px; z-index: 100;">
                <button id="btn-audio" class="mini-btn"
                    style="font-size: 1.5rem; background: transparent; border: none;">🔇</button>
            </div>
            <audio id="bgm" src="/static/kinotake/kinotake.mp3" loop preload="auto"></audio>
        </header>

        <div class="battle-arena">
            <div class="team bamboo">
                <h2>たけのこ派<br><span class="small">(1文改行)</span></h2>
                <div class="score" id="bamboo-score">0</div>
                <div class="bar-container">
                    <div class="bar" id="bamboo-bar"></div>
                </div>
                <button id="btn-bamboo" class="vote-btn">連打ァ！</button>
            </div>

            <div class="vs">VS</div>

            <div class="team mushroom">
                <h2>きのこ派<br><span class="small">(改行なし)</span></h2>
                <div class="score" id="mushroom-score">0</div>
                <div class="bar-container">
                    <div class="bar" id="mushroom-bar"></div>
                </div>
                <button id="btn-mushroom" class="vote-btn">連打ァ！</button>
            </div>
        </div>

        <div class="prettier-zone">
            <button id="btn-prettier" class="mini-btn">Prettierに任せる</button>
            <span id="prettier-score">0</span>
        </div>

        <!-- Cheat Input Area -->
        <div class="input-area">
            <input type="text" id="cheat-input" placeholder="隠しコマンド入力..."
                style="padding: 10px; border-radius: 5px; border: 1px solid #ccc; width: 60%; color: #333;">
            <button id="btn-cheat" class="mini-btn" style="padding: 10px 20px;">送信</button>
            <p style="font-size: 0.8rem; color: #888; margin-bottom: 0;">※ キーボード入力も有効です (例: 上上下下...)</p>
        </div>

        <div class="log-area" style="margin-top: 20px;">
            <h3>📜 最近の聖戦履歴</h3>
            <ul id="log-list">
                <!-- Logs will be injected here -->
            </ul>
        </div>

        <!-- Hidden trigger area in background -->
        <div id="hidden-trigger"></div>

        <!-- VIM DUNGEON OVERLAY -->
        <div id="vim-overlay">
            <h1>VIM DUNGEON</h1>
            <p>レッサーパンダは混乱している！<br>「出られないようだ....」</p>
            <div id="vim-boss"></div>
            <div id="qte-display"></div>
            <div id="vim-msg"></div>
            <div id="vim-options">
                <div class="vim-option" onclick="vimAction('fight')">▶︎ たたかう (:q! 連打)</div>
                <div class="vim-option" onclick="vimAction('escape')">▶︎ にげる (ブラウザを閉じる)</div>
                <div class="vim-option" onclick="vimAction('master')">▶︎ 手動改行を極める</div>
            </div>
        </div>

        <!-- Shatter Screen -->
        <div id="shatter-screen"></div>

        <!-- Victory Certificate Modal -->
        <div id="certificate-modal">
            <h2 id="cert-instruction">VIM DUNGEON 制覇！<br>名前を刻め！</h2>
            <div class="cert-controls" id="input-controls">
                <input type="text" id="cert-name-input" placeholder="あなたの名前 (8文字以内)" maxlength="8">
                <button id="btn-generate" class="cert-btn" onclick="generateCertificate()">証明書発行</button>
            </div>

            <img id="certificate-preview" src="" alt="Certificate Preview" style="display:none;">
            <canvas id="cert-canvas" width="1200" height="675" style="display:none;"></canvas>

            <div class="cert-controls" id="download-controls" style="display:none;">
                <button id="btn-download" class="cert-btn" onclick="downloadCertificate()">💾 画像保存</button>
                <button id="btn-share" class="cert-btn" onclick="shareOnX()">𝕏 で自慢する</button>
                <button class="cert-btn" onclick="location.reload()" style="background:#555;">戻る</button>
            </div>
        </div>
    </div>

    <!-- Assets: Renamed JS force cache clear -->
    <script src="/static/kinotake/kinotake.js?v=110"></script>
</body>

</html>